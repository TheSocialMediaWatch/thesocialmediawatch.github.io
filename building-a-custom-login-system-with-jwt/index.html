<!doctype html><html lang=en dir=auto><head><title>Building a Custom Login System with JWT</title>
<link rel=canonical href=https://various.googlexy.com/building-a-custom-login-system-with-jwt/><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><meta name=description content><meta name=author content><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://various.googlexy.com/logo.svg><link rel=icon type=image/png sizes=16x16 href=https://various.googlexy.com/logo.svg><link rel=icon type=image/png sizes=32x32 href=https://various.googlexy.com/logo.svg><link rel=apple-touch-icon href=https://various.googlexy.com/logo.svg><link rel=mask-icon href=https://various.googlexy.com/logo.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://various.googlexy.com/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="All the knowledge is here!"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://various.googlexy.com/"><meta name=twitter:card content="summary"><meta name=twitter:title content="All the knowledge is here!"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"All the knowledge is here!","url":"https://various.googlexy.com/","description":"","thumbnailUrl":"https://various.googlexy.com/logo.svg","sameAs":[]}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6194699946397512" crossorigin=anonymous></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://various.googlexy.com/ accesskey=h title="Home (Alt + H)"><img src=https://various.googlexy.com/logo.svg alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://various.googlexy.com/articles/ title=Articles><span>Articles</span></a></li><li><a href=https://various.googlexy.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Building a Custom Login System with JWT</h1><div class=post-description></div></header><figure class=entry-cover><img loading=eager src=https://various.googlexy.com/images/web-development.jpeg alt></figure><br><div class=post-content><p>In today’s web development landscape, creating a secure and efficient authentication system is vital for almost every modern application. JSON Web Tokens (JWT) have become a popular choice for implementing authentication due to their stateless nature, scalability, and ease of use across different platforms. This guide will walk you through building a custom login system using JWT from scratch, covering every essential aspect to master this critical skill.</p><hr><h2 id=understanding-jwt-and-its-role-in-authentication>Understanding JWT and Its Role in Authentication</h2><p>Before diving into implementation, let’s clarify what JWT is and why it fits well into custom login systems.</p><p>JWT is an open standard (RFC 7519) that defines a compact and self-contained way for transferring claims securely between parties as a JSON object. The tokens are digitally signed, ensuring the integrity and authenticity of the data they carry.</p><h3 id=components-of-a-jwt>Components of a JWT</h3><p>A JWT consists of three parts separated by dots:</p><ul><li><strong>Header</strong>: Specifies the token type (JWT) and the signing algorithm (e.g., HS256).</li><li><strong>Payload</strong>: Contains claims — pieces of information about the user and other metadata.</li><li><strong>Signature</strong>: The encoded header and payload are cryptographically signed using a secret key or public/private key pair.</li></ul><p>This structure allows servers to verify the token’s authenticity without maintaining session state, which is extremely advantageous for scalable systems.</p><hr><h2 id=designing-the-authentication-flow>Designing The Authentication Flow</h2><p>To build a custom login system, understanding the flow is crucial. Here’s an outline of the typical steps:</p><ol><li><strong>User Registration</strong>: Collect user credentials securely and store the hashed password.</li><li><strong>User Login</strong>: Validate credentials and generate a JWT upon successful authentication.</li><li><strong>Token Storage</strong>: The client stores the token (usually in localStorage or cookies).</li><li><strong>Protected Routes & APIs</strong>: On requests to protected resources, the client sends the JWT in the <code>Authorization</code> header.</li><li><strong>Token Verification</strong>: The server verifies the token’s signature and claims to authorize access.</li><li><strong>Token Expiry & Refresh</strong>: Implement token expiration for security and, optionally, use refresh tokens for seamless user experiences.</li><li><strong>User Logout</strong>: Invalidate tokens on the client side and manage server-side invalidation if needed.</li></ol><hr><h2 id=step-1-setting-up-the-project-environment>Step 1: Setting Up the Project Environment</h2><p>Start by creating a backend environment. We’ll use Node.js with Express for this example because of its simplicity and widespread adoption.</p><p>Initialize the project and install dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm init -y
</span></span><span class=line><span class=cl>npm install express jsonwebtoken bcryptjs body-parser cors dotenv
</span></span></code></pre></div><ul><li><strong>express</strong>: Web framework.</li><li><strong>jsonwebtoken</strong>: JWT creation and verification.</li><li><strong>bcryptjs</strong>: Password hashing.</li><li><strong>body-parser</strong>: Parsing incoming request bodies.</li><li><strong>cors</strong>: Enable Cross-Origin Resource Sharing.</li><li><strong>dotenv</strong>: Manage environment variables.</li></ul><hr><h2 id=step-2-user-registration-with-secure-password-hashing>Step 2: User Registration with Secure Password Hashing</h2><p>In a secure system, plaintext passwords should never be stored. Always hash passwords before saving them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bcrypt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bcryptjs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bodyParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;body-parser&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>bodyParser</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=p>[];</span> <span class=c1>// Using an in-memory array for users. Replace with a database in production.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span><span class=p>,</span> <span class=nx>password</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>username</span> <span class=o>||</span> <span class=o>!</span><span class=nx>password</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Username and password are required.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>existingUser</span> <span class=o>=</span> <span class=nx>users</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>u</span> <span class=p>=&gt;</span> <span class=nx>u</span><span class=p>.</span><span class=nx>username</span> <span class=o>===</span> <span class=nx>username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>existingUser</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;User already exists.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hashedPassword</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>users</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>username</span><span class=p>,</span> <span class=nx>password</span><span class=o>:</span> <span class=nx>hashedPassword</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;User registered successfully.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This simple endpoint validates input, checks if the user already exists, hashes the password securely, and stores the user.</p><hr><h2 id=step-3-creating-the-login-endpoint-and-generating-a-jwt>Step 3: Creating the Login Endpoint and Generating a JWT</h2><p>After registration, users need to authenticate and receive a token:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span><span class=p>,</span> <span class=nx>password</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>users</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>u</span> <span class=p>=&gt;</span> <span class=nx>u</span><span class=p>.</span><span class=nx>username</span> <span class=o>===</span> <span class=nx>username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid credentials.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>passwordMatch</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>passwordMatch</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid credentials.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span> <span class=p>},</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span> <span class=p>{</span> <span class=nx>expiresIn</span><span class=o>:</span> <span class=s1>&#39;1h&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>token</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Key Points:</strong></p><ul><li>The token contains the username in its payload.</li><li>The token is signed with a secret key defined in environment variables.</li><li>The token expires in 1 hour to minimize risk exposure.</li></ul><hr><h2 id=step-4-securing-api-routes-with-middleware>Step 4: Securing API Routes with Middleware</h2><p>To protect endpoints, middleware should verify the token’s authenticity:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>authenticateToken</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>authHeader</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;authorization&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>authHeader</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Authorization header required.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>authHeader</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>];</span> <span class=c1>// Format: &#34;Bearer &lt;token&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Token missing.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid or expired token.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>req</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/protected&#39;</span><span class=p>,</span> <span class=nx>authenticateToken</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=sb>`Welcome, </span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>username</span><span class=si>}</span><span class=sb>! This is a protected route.`</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This middleware extracts the token, verifies it, and attaches the user info to the request object. Routes using this middleware become accessible only to users with valid tokens.</p><hr><h2 id=step-5-managing-token-expiry-and-refresh-tokens>Step 5: Managing Token Expiry and Refresh Tokens</h2><h3 id=why-refresh-tokens>Why Refresh Tokens?</h3><p>Access tokens typically have a short lifespan to reduce the impact of compromised tokens. Refresh tokens extend session duration without sacrificing security.</p><h3 id=implementing-refresh-tokens>Implementing Refresh Tokens</h3><p>Add endpoints for refreshing access tokens:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>refreshTokens</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/token&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>token</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Refresh token required.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>refreshTokens</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>token</span><span class=p>))</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid refresh token.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REFRESH_TOKEN_SECRET</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid refresh token.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>accessToken</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span> <span class=p>},</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span> <span class=p>{</span> <span class=nx>expiresIn</span><span class=o>:</span> <span class=s1>&#39;15m&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>accessToken</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=issuing-refresh-tokens-during-login>Issuing Refresh Tokens During Login</h3><p>Modify the login endpoint to issue a refresh token alongside the access token:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>refreshToken</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span> <span class=p>},</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REFRESH_TOKEN_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>refreshTokens</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>refreshToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>accessToken</span><span class=o>:</span> <span class=nx>token</span><span class=p>,</span> <span class=nx>refreshToken</span> <span class=p>});</span>
</span></span></code></pre></div><h3 id=logout-endpoint>Logout Endpoint</h3><p>Invalidate refresh tokens on logout:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>token</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>refreshTokens</span> <span class=o>=</span> <span class=nx>refreshTokens</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>t</span> <span class=p>=&gt;</span> <span class=nx>t</span> <span class=o>!==</span> <span class=nx>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>204</span><span class=p>).</span><span class=nx>send</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><hr><h2 id=step-6-storing-tokens-safely-on-the-client-side>Step 6: Storing Tokens Safely on the Client Side</h2><p>How you store tokens impacts your application&rsquo;s security:</p><ul><li><strong>Access Tokens</strong>: Usually stored in memory or HTTP-only cookies to avoid exposure to XSS attacks.</li><li><strong>Refresh Tokens</strong>: Should always be stored in HTTP-only, secure cookies to prevent scripts from accessing them.</li></ul><p>Avoid storing tokens in localStorage or regular cookies unless you fully understand the security trade-offs.</p><hr><h2 id=step-7-enhancing-security-with-best-practices>Step 7: Enhancing Security with Best Practices</h2><p>Beyond hashing and token management, consider these practices:</p><ul><li>Use <strong>HTTPS</strong> to protect tokens during transport.</li><li>Regularly <strong>rotate secrets</strong> used to sign tokens.</li><li>Limit the <strong>scope and claims</strong> embedded in JWT to the minimum required.</li><li>Log and monitor token usage for unusual activity.</li><li>Use <strong>short-lived access tokens</strong> paired with refresh tokens.</li><li>Implement <strong>rate limiting</strong> on authentication endpoints.</li><li>Sanitize and validate all input data rigorously.</li></ul><hr><h2 id=step-8-scaling-the-system-and-persistent-storage>Step 8: Scaling the System and Persistent Storage</h2><p>For production systems, replace the in-memory user and token storage with persistent databases like PostgreSQL or MongoDB. Persistent storage allows:</p><ul><li>User data retention across server restarts.</li><li>Token blacklisting or revocation strategies.</li><li>Enhanced audit and logging capabilities.</li></ul><p>Also, consider integrating identity providers (OAuth, OpenID Connect) for social login options and broader authentication solutions.</p><hr><h2 id=summary>Summary</h2><p>Developing a custom login system using JWT involves several critical components: secure password storage, token-based authentication, middleware for route protection, token lifecycle management, and secure client-side storage. By following the steps outlined here, you can build a robust, scalable login system tailored to your application’s unique needs and security requirements.</p><p>This approach enhances user experience by enabling seamless authentication flows without costly server-side session management, while maintaining strong security practices.</p><hr><h2 id=next-steps>Next Steps</h2><ul><li>Implement frontend logic to handle token storage, renewal, and usage.</li><li>Introduce account confirmation and password reset functionality.</li><li>Explore multi-factor authentication to strengthen account security.</li><li>Optimize performance by caching JWT validations if appropriate.</li></ul><p>With this foundation, your custom login system will serve as a solid backbone for your application’s security infrastructure. Happy coding!</p></div><footer class=post-footer><nav class=paginav>Category:<a href=https://various.googlexy.com/categories/web-development/>Web Development</a></nav><nav class=paginav><a class=prev href=https://various.googlexy.com/building-a-crowdfunding-platform-empowering-projects-with-collective-support/><span class=title>« Prev</span><br><span>Building a Crowdfunding Platform: Empowering Projects with Collective Support</span>
</a><a class=next href=https://various.googlexy.com/building-a-job-board-website-essential-features-and-functionality/><span class=title>Next »</span><br><span>Building a Job Board Website: Essential Features and Functionality</span></a></nav><nav class=paginav><ul style=list-style-type:none><li><small>See Also</small></li><li><ul style=list-style-type:none><li><small><a href=/mastering-css-flexbox-simplifying-layout-design/>Mastering CSS Flexbox: Simplifying Layout Design</a></small></li><li><small><a href=/creating-accessible-forms-for-users-with-disabilities/>Creating Accessible Forms for Users with Disabilities</a></small></li><li><small><a href=/guide-to-optimizing-website-performance-for-seo/>Guide to Optimizing Website Performance for SEO</a></small></li><li><small><a href=/building-secure-authentication-systems-for-web-applications/>Building Secure Authentication Systems for Web Applications</a></small></li><li><small><a href=/creating-engaging-landing-pages-for-better-conversions/>Creating Engaging Landing Pages for Better Conversions</a></small></li></ul></li></ul></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://various.googlexy.com/>All the knowledge is here!</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>